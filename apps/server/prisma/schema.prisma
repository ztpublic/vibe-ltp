// Prisma schema for vibe-ltp

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Puzzle {
  id             String   @id @default(uuid())
  soupSurface    String
  soupBottom     String
  tags           String[]
  difficulty     String   // EASY, MEDIUM, HARD, EXPERT
  sourceLanguage String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  rooms Room[]

  @@map("puzzles")
}

model Room {
  id        String   @id @default(uuid())
  puzzleId  String
  status    String   // WAITING_FOR_PLAYERS, IN_PROGRESS, SOLVED, ABANDONED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  puzzle       Puzzle            @relation(fields: [puzzleId], references: [id])
  participants RoomParticipant[]
  questions    Question[]

  @@map("rooms")
}

model RoomParticipant {
  id       String   @id @default(uuid())
  roomId   String
  socketId String   // Socket connection ID
  role     String   // HOST, PLAYER, SPECTATOR
  joinedAt DateTime @default(now())

  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@unique([roomId, socketId])
  @@map("room_participants")
}

model Question {
  id       String   @id @default(uuid())
  roomId   String
  socketId String   // Socket connection ID of asker
  text     String
  askedAt  DateTime @default(now())

  room    Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  answers Answer[]

  @@map("questions")
}

model Answer {
  id          String   @id @default(uuid())
  questionId  String
  type        String   // YES, NO, MAYBE, IRRELEVANT
  explanation String?
  answeredAt  DateTime @default(now())

  question Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@map("answers")
}
